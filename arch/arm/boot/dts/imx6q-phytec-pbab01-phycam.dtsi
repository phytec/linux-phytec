// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (C) 2020 PHYTEC Messtechnik GmbH
 * Author: Stefan Riedmueller <s.riedmueller@phytec.de>
 */

#include "imx6qdl-phytec-pbab01-phycam.dtsi"

/ {
	clk_cam1: clk-cam1 {
		#clock-cells = <0>;

		compatible = "fixed-clock";
		clock-frequency = <27000000>;

		status = "disabled";
	};

	reg_vcc_cam1: regulator-cam1 {
		compatible = "regulator-fixed";
		regulator-name = "VCC_CAM1";
		regulator-min-microvolt = <2800000>;
		regulator-max-microvolt = <2800000>;
	};

	thermal-zones {
		vm016_1_thermal: vm016-1-thermal {
			polling-delay = <0>;
			polling-delay-passive = <0>;

			thermal-sensors = <&vm016_1>;
			status = "disabled";
		};
	};
};

&i2c3 {
	/* VM-011 */
	mt9p031_1: mt9p031_1@48 {
		compatible = "aptina,mt9p031";
		pinctrl-names = "default";
		pinctrl-0 = <
			&pinctrl_cam1data
			&pinctrl_cam1clk
		>;
		reg = <0x48>;
		status = "disabled";

		vdd-supply = <&reg_vcc_cam1>;
		vdd_io-supply = <&reg_vcc_cam1>;
		vaa-supply = <&reg_vcc_cam1>;

		clocks = <&clks IMX6QDL_CLK_CKO2>;

		assigned-clocks =
			<&clks IMX6QDL_CLK_CKO2_SEL>,
			<&clks IMX6QDL_CLK_ESAI_SEL>,
			<&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>,
			<&clks IMX6QDL_CLK_ESAI_EXTAL>;

		assigned-clock-parents =
			<&clks IMX6QDL_CLK_ESAI_EXTAL>,
			<&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>;

		assigned-clock-rates = <0>, <0>, <216000000>, <54000000>;

		port {
			mt9p031_ep1: endpoint {
				remote-endpoint = <
					&ipu2_csi1_mux_from_parallel_sensor
				>;
				input-clock-frequency = <54000000>;
				pixel-clock-frequency = <54000000>;
				bus-width = <8>;
				hsync-active = <1>;
				vsync-active = <1>;
				pclk-sample = <1>;
			};
		};
	};

	/* VM-010 */
	mt9v024_1: mt9v024_1@48 {
		compatible = "aptina,mt9v024";
		pinctrl-names = "default";
		pinctrl-0 = <
			&pinctrl_cam1data
			&pinctrl_cam1clk
		>;
		reg = <0x48>;
		status = "disabled";

		clocks = <&clks IMX6QDL_CLK_CKO2>;

		assigned-clocks =
			<&clks IMX6QDL_CLK_CKO2_SEL>,
			<&clks IMX6QDL_CLK_ESAI_SEL>,
			<&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>,
			<&clks IMX6QDL_CLK_ESAI_EXTAL>;

		assigned-clock-parents =
			<&clks IMX6QDL_CLK_ESAI_EXTAL>,
			<&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>;

		assigned-clock-rates = <0>, <0>, <216000000>, <54000000>;

		port {
			mt9v024_ep1_0: endpoint {
				remote-endpoint = <
					&ipu2_csi1_mux_from_parallel_sensor
				>;
				link-frequencies = /bits/ 64 <27000000>;
				bus-width = <8>;
				hsync-active = <1>;
				vsync-active = <1>;
			};
		};
        };

	/* VM-009 */
	mt9m111_1: mt9m111_1@48 {
		compatible = "micron,mt9m111";
		pinctrl-names = "default";
		pinctrl-0 = <
			&pinctrl_cam1data
			&pinctrl_cam1clk
		>;
		reg = <0x48>;
		status = "disabled";

		clocks = <&clks IMX6QDL_CLK_CKO2>;
		clock-names = "mclk";
		phytec,invert-pixclk;

		assigned-clocks =
			<&clks IMX6QDL_CLK_CKO2_SEL>,
			<&clks IMX6QDL_CLK_ESAI_SEL>,
			<&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>,
			<&clks IMX6QDL_CLK_ESAI_EXTAL>;

		assigned-clock-parents =
			<&clks IMX6QDL_CLK_ESAI_EXTAL>,
			<&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>;

		assigned-clock-rates = <0>, <0>, <216000000>, <54000000>;

		port {
			mt9m111_ep1: endpoint {
				remote-endpoint = <
					&ipu2_csi1_mux_from_parallel_sensor
				>;
				bus-width = <8>;
				hsync-active = <1>;
				vsync-active = <1>;
			};
		};
	};

	/* VM-012 */
	vm012_1: vm012_1@48 {
		compatible = "phytec,vm012m";
		pinctrl-names = "default";
		pinctrl-0 = <
			&pinctrl_cam1data
			&pinctrl_cam1clk
		>;
		reg = <0x48>;
		status = "disabled";

		clocks = <&clks IMX6QDL_CLK_CKO2>;
		sysclk = <54000000>;

		assigned-clocks =
			<&clks IMX6QDL_CLK_CKO2_SEL>,
			<&clks IMX6QDL_CLK_ESAI_SEL>,
			<&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>,
			<&clks IMX6QDL_CLK_ESAI_EXTAL>;

		assigned-clock-parents =
			<&clks IMX6QDL_CLK_ESAI_EXTAL>,
			<&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>;

		assigned-clock-rates = <0>, <0>, <216000000>, <216000000>;

		port {
			vm012_ep1: endpoint {
				remote-endpoint = <
					&ipu2_csi1_mux_from_parallel_sensor
				>;
				/* HACK: set some attribute; else BT.656 mode
				will be assumed silently */
				hsync-active = <1>;
				vsync-active = <1>;
				bus-width = <10>;
			};
		};
	};

	/* VM-016 */
	vm016_1: vm016@18 {
		#address-cells = <0x1>;
		#size-cells = <0x0>;
		#thermal-sensor-cells = <0>;

		compatible = "onsemi,ar0144";
		pinctrl-names = "default";
		pinctrl-0 = <
			&pinctrl_cam1data
			&pinctrl_cam1clk
		>;
		reg = <0x18>;
		status = "disabled";

		clock-names = "ext", "synch";
		clocks = <
			&clk_cam1
			&clks IMX6QDL_CLK_CKO2
		>;

		assigned-clocks = <
			&clks IMX6QDL_CLK_CKO2_SEL
			&clks IMX6QDL_CLK_ESAI_SEL
			&clks IMX6QDL_CLK_PLL4_AUDIO_DIV
			&clks IMX6QDL_CLK_ESAI_EXTAL
		>;

		assigned-clock-parents = <
			&clks IMX6QDL_CLK_ESAI_EXTAL
			&clks IMX6QDL_CLK_PLL4_AUDIO_DIV
		>;

		assigned-clock-rates = <
			0
			0
			216000000
			72000000
		>;

		vdd-supply = <&reg_vcc_cam1>;
		vddio-supply = <&reg_vcc_cam1>;
		vaa-supply = <&reg_vcc_cam1>;
		vaapix-supply = <&reg_vcc_cam1>;

		port@0 {
			reg = <0x0>;

			vm016_1_ep0: endpoint {
				remote-endpoint = <&ipu2_csi1_mux_from_parallel_sensor>;

				onsemi,data-shift = <0>;
				onsemi,slew-rate-dat = <3>;
				onsemi,slew-rate-clk = <3>;

				data-shift = <4>;
				bus-width = <12>;
				hsync-active = <1>;
				vsync-active = <1>;
				link-frequencies = /bits/ 64 < 72000000 >;
			};
		};
	};

	/* VM-050 */
	vm050_1: vm050_1@4e {
		#gpio-cells = <2>;
		compatible = "phytec,vm050";
		pinctrl-names = "default";
		pinctrl-0 = <
			&pinctrl_cam1data
			&pinctrl_cam1clk
		>;

		reg = <0x4e>;
		status = "disabled";

		port {
			vm050_ep1: endpoint {
				/* HACK: set some attribute; else BT.656 mode
				will be assumed silently */
				hsync-active = <1>;
				bus-width = <8>;
				remote-endpoint = <&ipu2_csi1_mux_from_parallel_sensor>;
			};
		};
	};
};

&iomuxc {
	pinctrl_cam1clk: cam1clkgrp {
		fsl,pins = <
			MX6QDL_PAD_NANDF_CS2__CCM_CLKO2		0xb9
		>;
	};

	pinctrl_cam1data: cam1datagrp {
		fsl,pins = <
			/* Syntax error here?! */
			MX6QDL_PAD_EIM_A17__IPU2_CSI1_DATA12	0x1b0b0
			MX6QDL_PAD_EIM_A18__IPU2_CSI1_DATA13	0x1b0b0
			MX6QDL_PAD_EIM_A19__IPU2_CSI1_DATA14	0x1b0b0
			MX6QDL_PAD_EIM_A20__IPU2_CSI1_DATA15	0x1b0b0
			MX6QDL_PAD_EIM_A21__IPU2_CSI1_DATA16	0x1b0b0
			MX6QDL_PAD_EIM_A22__IPU2_CSI1_DATA17	0x1b0b0
			MX6QDL_PAD_EIM_A23__IPU2_CSI1_DATA18	0x1b0b0
			MX6QDL_PAD_EIM_A24__IPU2_CSI1_DATA19	0x1b0b0
			MX6QDL_PAD_EIM_DA11__IPU2_CSI1_HSYNC	0x1b0b0
			MX6QDL_PAD_EIM_A16__IPU2_CSI1_PIXCLK	0x4001b0b0
			MX6QDL_PAD_EIM_DA12__IPU2_CSI1_VSYNC	0x1b0b0
		>;
	};
};

&ipu2_csi1_mux_from_parallel_sensor {
	remote-endpoint = <&mt9p031_ep1>;
};
